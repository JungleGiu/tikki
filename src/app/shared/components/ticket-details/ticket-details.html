@if (isVisible()) {
<div class="overlay-modal">
  <div class="modal">
    <header>
      <button class="close" (click)="isVisible.set(false)">X</button>
      @if (mode() === 'edit' || mode() === 'view') { 
      <h3>{{ ticket.title }}</h3>
      <p>{{ ticket.description }}</p>}
      @if (mode() === 'create') {
      <h3>New Ticket</h3>
      }
    </header>
    <div class="modal-body">
      @if (mode() === 'create') {
      <form [formGroup]="createForm">
        <div class="field">
          <label for="title">Title</label>
          <input type="text" id="title" formControlName="title" />
        </div>
        <div class="field">
          <label for="description">Description</label>
          <textarea
            id="description"
            formControlName="description"
          ></textarea>
        </div>
        <div class="field">
          <label for="priority">Priority</label>
          <select id="priority" formControlName="priority">
            <option value="1">Critical</option>
            <option value="2">High</option>
            <option value="3">Medium</option>
            <option value="4">Low</option>
          </select>
        </div>
        <div class="field">
          <label for="department">Department</label>
          <select id="department" formControlName="department_id">
            <option value="1">IT</option>
            <option value="2">HR</option>
            <option value="3">Sales</option>
            <option value="4">Marketing</option>
          </select>
        </div>
        <app-location-input (newLocation)="onLocationSelected($event)"></app-location-input>
        <div class="field">
          <label for="deadline">Deadline</label>
          <input type="date" id="deadline" formControlName="deadline" />
        </div>
      </form>
      }
      @if (mode() === 'view') {
      <div class="categories">
        <span>Department:</span
        ><app-badge [variant]="ticket.department_id | departmentPipe"
          >Department: {{ ticket.department_id | departmentPipe }}</app-badge
        >

        <span>Priority:</span
        ><app-badge [variant]="ticket.priority | priority">{{
          ticket.priority | priority
        }}</app-badge>
      </div>
      <p><span>Deadline:</span> {{ ticket.deadline | date }}</p>
      <p><span>Location: </span>{{ ticket.location.name }}</p>
      <p><span>Created By:</span> {{ ticket.created_by | userName }}</p>
      <p><span>Created At:</span> {{ ticket.created_at | date }}</p>
      <p><span>Assigned To:</span> {{ ticket.assigned_to | userName }}</p>
      <p><span>Resolved At:</span> {{ ticket.resolved_at | date }}</p>
      <p><span>Status:</span> {{ ticket.status | status }}</p>

      } @if (mode() === 'edit' && ticket) {
      <form [formGroup]="editForm">
        <div class="field">
          <label for="priority">Priority</label>
          <select id="priority" formControlName="priority">
            <option value="" disabled>Select Priority</option>
            @for (option of priorityOptions; track option.value) {
            <option [value]="option.value.toString()">{{ option.label }}</option>
            }
          </select>
        </div>
        <div class="field">
          <label for="deadline">Deadline</label>
          <input type="date" id="deadline" formControlName="deadline" />
        </div>
        <div class="field">
          <app-location-input
            (newLocation)="onLocationSelected($event)"
            [location]="ticket.location"
          ></app-location-input>
        </div>
        <div class="field">
          <label for="assigned_to">Assigned To</label>
          <select id="assigned_to" formControlName="assigned_to">
            <option value="" disabled>Select User</option>
            @for (user of users(); track user.id) {
            <option [value]="user.id">{{ user.name }}</option>
            }
          </select>
        </div>
        <div class="field">
          <label for="status">Status</label>
          <select id="status" formControlName="status">
            <option value="" disabled>Select Status</option>
            @for (option of statusOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </div>
      </form>
      }
    </div>
    <div class="modal-footer">
      @if (!editMode() && mode() === 'view') {
      <button (click)="editMode.set(true); mode.set('edit')">Edit</button>
      <button (click)="deleteDialog.set(true)">Delete</button>
      } @if (editMode() ) {
      <button (click)="editMode.set(false); mode.set('view')">Cancel</button>
      <button (click)="onEditSubmit()">Save</button>
      }
@if (mode() === 'create') {
      <button (click)="onCreateSubmit()">Create</button>
      }
    </div>
  </div>
</div>
} @if (deleteDialog()) {

<app-confirm-delete-dialog
  (cancel)="deleteDialog.set(false)"
  (confirm)="onDelete($event)"
  [id]="ticket.id"
  [item]="'ticket'"
></app-confirm-delete-dialog>

}

